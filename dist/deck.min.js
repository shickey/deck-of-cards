"use strict";var Deck=function(){function n(n,e){var o=Date.now(),r=o+n,i=r+e,a={start:r,end:i};C.push(a),$||($=!0,requestAnimationFrame(t));var c={start:function(n){return a.startcb=n,c},progress:function(n){return a.progresscb=n,c},end:function(n){return a.endcb=n,c}};return c}function t(){var n=Date.now();if(!C.length)return void($=!1);for(var e,o=0;o<C.length;o++)if(e=C[o],!(n<e.start)){e.started||(e.started=!0,e.startcb&&e.startcb());var r=(n-e.start)/(e.end-e.start);e.progresscb&&e.progresscb(r<1?r:1),n>e.end&&(e.endcb&&e.endcb(),C.splice(o--,1))}requestAnimationFrame(t)}function e(n){return(Math.round(Math.random())?-1:1)*n}function o(){return window.getComputedStyle(document.body).getPropertyValue("font-size").slice(0,-2)}function r(n){for(var t,e,o=n.length-1;o;o--)t=Math.floor(Math.random()*(o+1)),e=n[o],n[o]=n[t],n[t]=e;return n}function i(n){if(void 0!==P[n])return P[n];if(void 0!==O[n])return P[n]=n,n;for(var t,e=n[0].toUpperCase()+n.slice(1),o=["webkit","moz","Moz","ms","o"],r=0,i=o.length;r<i;r++)if(t=o[r]+e,void 0!==O[t])return P[n]=t,t}function a(n,t,e){return void 0!==S||(S=c()),e=e||0,S?"translate3d("+n+", "+t+", "+e+")":"translate("+n+", "+t+")"}function c(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!1;var n=i("transform"),t=document.createElement("p");return document.body.appendChild(t),t.style[n]="translate3d(1px,1px,1px)",S=t.style[n],S=null!=S&&S.length&&"none"!==S,document.body.removeChild(t),S}function u(n){return n*Math.PI/180}function d(n){return document.createElement(n)}function s(t){function e(n){n.appendChild(v),g.$root=n}function o(){g.$root&&g.$root.removeChild(v),g.$root=null}function r(n){n===s.Side.FRONT?(g.side===s.Side.BACK&&v.removeChild(m),g.side=s.Side.FRONT,v.appendChild(y),g.setRankSuit(g.rank,g.suit)):(g.side===s.Side.FRONT&&v.removeChild(y),g.side=s.Side.BACK,v.appendChild(m),v.classList.remove("rank"+g.rank),v.classList.remove(l(g.suit)))}var c,u=i("transform"),f=t%13+1,p=t/13|0,h=(52-t)/4,v=d("div"),y=d("div"),m=d("div"),g={i:t,rank:f,suit:p,side:s.Side.BACK,pos:t,$el:v,mount:e,unmount:o,setSide:r},$=x.modules;v.classList.add("card"),y.classList.add("face"),m.classList.add("back"),v.style[u]=a(-h+"px",-h+"px"),g.x=-h,g.y=-h,g.z=h,g.rot=0,g.setSide(s.Side.BACK);for(c in $)!function(n){n.card&&n.card(g)}($[c]);return g.animateTo=function(t){var e=t.delay,o=t.duration,r=t.x,i=void 0===r?g.x:r,c=t.y,d=void 0===c?g.y:c,s=t.rot,l=void 0===s?g.rot:s,f=t.ease,p=t.onStart,h=t.onProgress,y=t.onComplete;e=e||0,o=o||500;var m,x,$,C,b,k;n(e,o).start(function(){m=g.x||0,x=g.y||0,$=g.rot||0,p&&p()}).progress(function(n){var t=w[f||"cubicInOut"](n);C=i-m,b=d-x,k=l-$,h&&h(n,t),g.x=m+C*t,g.y=x+b*t,g.rot=$+k*t,v.style[u]=a(g.x+"px",g.y+"px")+(g.rot?"rotate("+g.rot+"deg)":"")}).end(function(){y&&y()})},g.setGlow=function(n){n?g.$el.classList.add("glow"):g.$el.classList.remove("glow")},g.setRankSuit=function(n,t){var e=l(t);v.classList.add(e,"rank"+n)},g.setRankSuit(f,p),g}function l(n){return 0===n?"spades":1===n?"hearts":2===n?"clubs":3===n?"diamonds":"joker"}function f(){return 3.875*o()}function p(){return 5.5*o()}function h(t,e,o){function r(n){var t={};t=0===p.cards.length?h:p.cards[p.cards.length-1],n?(t.setGlow(!0),t.$el.onclick=function(){"function"==typeof p.onSelect&&p.onSelect()}):(t.setGlow(!1),t.$el.onclick=null)}var c=o.x,u=o.y,l=o.rot,f=o.side;c=c||0,u=u||0,l=l||0,f=f||s.Side.BACK;var p=Object.assign(m(t,e),{x:c,y:u,rot:l,side:f,$root:t.$root,selectionEnabled:!1});e.forEach(function(n){n.$el.onclick=null});var h={$el:d("div")},v=h.$el,y=i("transform");v.classList.add("card"),v.style[y]=a(p.x+"px",p.y+"px"),v.style.zIndex=-1,h.setGlow=function(n){n?this.$el.classList.add("glow"):this.$el.classList.remove("glow")},p.$root.appendChild(v);var g={$el:d("div")},x=g.$el,y=i("transform");x.classList.add("helper"),x.style[y]=a(p.x+"px",p.y+"px"),x.style.zIndex=100;var $=!1;return p.showHelper=function(t,e){var o=e&&e.animationDuration||(t?500:250);t?(e&&e.content&&(g.$el.textContent="",g.$el.appendChild(e.content)),$||p.queued(function(t){var e=D.getCardWidth(),r=e/10,i=p.cards.length/4,c=p.x+e/2+r+e/8-i;g.$el.style[y]=a(c+"px",p.y-i+"px"),g.$el.style.opacity=0,p.$root.appendChild(g.$el),n(0,o).progress(function(n){var t=w.cubicInOut(n);g.$el.style.opacity=t}).end(function(){t()})},"PILE ("+p.id+") show helper")(),$=!0):($&&function(){var t=function(n){n.stopPropagation()};g.$el.addEventListener("click",t,!0),p.queued(function(e){n(0,o).progress(function(n){var t=w.cubicInOut(n);g.$el.style.opacity=1-t}).end(function(){g.$el.removeEventListener("click",t,!0),p.$root.removeChild(g.$el),e()})},"PILE ("+p.id+") hide helper")()}(),$=!1)},p.layout=function(n){if(0!==p.cards.length||$){var t=p.cards.slice(),e=D.getCardWidth(),o=e/10;p.queued(function(n){if(t.length>0){if(t.forEach(function(e,o){var r=o/4;e.setSide(p.side),e.$el.style.zIndex=o,e.animateTo({delay:0,duration:200,x:p.x-r,y:p.y-r,rot:p.rot,onComplete:function(){o===t.length-1&&n()}})}),$){var r=t.length/4,i=p.x+e/2+o+e/8-r;g.$el.style[y]=a(i+"px",p.y-r+"px")}}else $&&(g.$el.style[y]=a(p.x+"px",p.y+"px"))},"HAND ("+p.id+") layout "+(n?": "+n:""))()}},p.popCard=function(n){if(p.selectionEnabled&&r(!1),void 0===n&&(n=1),1==n)return p.cards.pop();if(n<=0)return[];for(var t=[],e=0;e<n;++e)t.push(p.cards.pop());return p.selectionEnabled&&p.cards.length>0&&r(!0),t},p.pushCard=function(n){p.selectionEnabled&&r(!1),p.cards.push(n),p.selectionEnabled&&r(!0)},p.enableSelection=function(n){p.queued(function(t){p.selectionEnabled=n,r(n),t()},"PILE ("+p.id+") enable selection ("+n+")")()},p.layout(),p}function v(t,e,o){function r(n,t){t?(n.setGlow(!0),n.$el.onclick=function(){if("function"==typeof h.onSelect){var t=h.cards.indexOf(n);h.onSelect(n,t)}}):(n.setGlow(!1),n.$el.onclick=null)}var c=o.x,u=o.y,l=o.rot,f=o.side;c=c||0,u=u||0,l=l||0,f=f||s.Side.BACK;var p=new Set,h=Object.assign(m(t,e),{x:c,y:u,rot:l,side:f,prominentCards:p,$root:t.$root});h.cards.forEach(function(n){n.$el.onclick=null});var v={$el:d("div")},y=v.$el,g=i("transform");y.classList.add("helper"),y.style[g]=a(h.x+"px",h.y+"px"),y.style.zIndex=100;var x=!1;return h.showHelper=function(t,e){var o=e&&e.animationDuration||(t?500:250);t?(e&&e.content&&(v.$el.textContent="",v.$el.appendChild(e.content)),x||h.queued(function(t){if(h.cards.length>0){var e=D.getCardWidth(),r=e/10,i=e*(h.cards.length-1)+r*(h.cards.length-1),c=-i/2,u=c+(e+r)*h.cards.length-3*e/8,d=h.rot*Math.PI/180,s=u*Math.cos(d),l=u*Math.sin(d);v.$el.classList.remove("alone"),v.$el.style[g]=a(h.x+s+"px",h.y+l+"px")+(h.rot?"rotate("+h.rot+"deg)":"")}else v.$el.classList.add("alone"),v.$el.style[g]=a(h.x+"px",h.y+"px")+(h.rot?"rotate("+h.rot+"deg)":"");v.$el.style.opacity=0,h.$root.appendChild(v.$el),n(0,o).progress(function(n){var t=w.cubicInOut(n);v.$el.style.opacity=t}).end(function(){t()})},"HAND ("+h.id+") show helper")(),x=!0):(x&&function(){var t=function(n){n.stopPropagation()};v.$el.addEventListener("click",t,!0),h.queued(function(e){n(0,o).progress(function(n){var t=w.cubicInOut(n);v.$el.style.opacity=1-t}).end(function(){v.$el.removeEventListener("click",t,!0),h.$root.removeChild(v.$el),e()})},"HAND ("+h.id+") hide helper")()}(),x=!1)},h.layout=function(n){if(0!==h.cards.length||x){var t=h.cards.slice(),e=D.getCardWidth(),o=D.getCardHeight(),r=e/10;h.queued(function(n){if(t.length>0){var i=e*(t.length-1)+r*(t.length-1),c=-i/2;if(t.forEach(function(i,a){i.setSide(h.side);var u=c+(e+r)*a,d=h.prominentCards.has(a)?-o/4:0,s=h.rot*Math.PI/180,l=u*Math.cos(s)-d*Math.sin(s),f=u*Math.sin(s)+d*Math.cos(s);i.animateTo({duration:200,x:h.x+l,y:h.y+f,rot:h.rot,onComplete:function(){a===t.length-1&&n()}})}),x){var u=c+(e+r)*t.length-3*e/8,d=h.rot*Math.PI/180,s=u*Math.cos(d),l=u*Math.sin(d);v.$el.classList.remove("alone"),v.$el.style[g]=a(h.x+s+"px",h.y+l+"px")+(h.rot?"rotate("+h.rot+"deg)":"")}}else x&&(v.$el.classList.remove("alone"),v.$el.style[g]=a(h.x+"px",h.y+"px")+(h.rot?"rotate("+h.rot+"deg)":""))},"HAND ("+h.id+") layout "+(n?": "+n:""))()}},h.setCardProminentAtIndex=function(n,t){t&&!h.prominentCards.has(n)?h.prominentCards.add(n):!t&&h.prominentCards.has(n)&&h.prominentCards.delete(n)},h.cardAtIndexIsProminent=function(n){return h.prominentCards.has(n)},h.peek=function(n){var t=0,e=h.cards.slice();h.queued(function(o){e.forEach(function(o){o.setGlow(!0);var r=function r(){t++,t<n?(o.setSide(s.Side.FRONT),o.$el.onclick=null,o.setGlow(!1)):t==n?(o.setSide(s.Side.FRONT),e.forEach(function(n){n.$el.onclick=r,n.setGlow(!0)})):e.forEach(function(n){n.setSide(s.Side.BACK),n.setGlow(!1),n.$el.onclick=null,"function"==typeof h.onPeek&&h.onPeek()})};o.$el.onclick=r}),o()},"HAND ("+h.id+") peek")()},h.enableSelection=function(n){h.queued(function(t){h.selectionEnabled=n,h.cards.forEach(function(t){r(t,n)}),t()},"HAND ("+h.id+") enable selection ("+n+")")()},h.addCard=function(n){h.cards.push(n)},h.removeCardAtIndex=function(n){if(!(n>=h.cards.length)){var t=h.cards[n];h.selectionEnabled&&r(t,!1),h.cards.splice(n,1),h.prominentCards.has(n)&&h.prominentCards.delete(n);var e=new Set;for(var o in h.prominentCards.values())o.value<n?e.add(o.value):e.add(o.value-1);return h.prominentCards=e,t}},h.insertCardAtIndex=function(n,t){if(!(t<0)){if(t>h.cards.length)return void h.addCard(n,options);h.cards.splice(t,0,n);var e=new Set;for(var o in h.prominentCards.values())o.value<t?e.add(o.value):e.add(o.value+1);h.prominentCards=e}},h.replaceCardAtIndex=function(n,t){var e=h.cards[n];return h.selectionEnabled&&r(e,!1),h.selectionEnabled&&r(t,!0),h.cards[n]=t,e},h.layout(),h}function y(n){function t(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e})}function e(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e,once:!0})}function o(n){var t=this,e=Array.prototype.slice(arguments,1);(i[n]||[]).filter(function(n){return n.cb.apply(t,e),!n.once})}function r(n,t){return n?t?void(i[n]=i[n].filter(function(n){return n.cb!==t})):void(i[n]=[]):void(i={})}n||(n={});var i={};return n.on=t,n.one=e,n.off=r,n.trigger=o,n}function m(n,t,e){var o=e&&e.id||n.generateNextCliqueId(),r=y({id:o,deck:n,cards:t,queued:n.queued,beginQueueTransaction:n.beginQueueTransaction,endQueueTransaction:n.endQueueTransaction,withQueueTransaction:n.withQueueTransaction}),i=x.modules;for(var a in i)!function(n){n.deck&&n.deck(r)}(i[a]);return r.serialize=function(){return{id:r.id,cardIds:r.cards.map(function(n){return n.i})}},r.gatherCards=function(n){var t=[];n.forEach(function(n){var e=r.deck.cards.find(function(t){return n==t.i});void 0!==r.side&&e.setSide(r.side),t.push(e)}),r.cards=t,"function"==typeof r.layout&&r.layout("gather cards")},n.cliques[r.id]=r,r}function g(n){function t(n,t){return function(){var o=this,r=arguments;e(function(t){n.apply(o,c.concat.apply(t,r))},t)}}function e(n,t){n&&(d?s.push({action:n,description:t}):(u.push({action:n,description:t}),1===u.length&&o()))}function o(){u[0].action(function(n){if(n)throw n;u=u.slice(1),u.length&&o()})}function r(){if(d)return void console.log("WARNING: Tried to begin a queue transaction while another was open. Ignoring.");s=[],d=!0}function i(){if(!d)return void console.log("WARNING: Tried to close a queue transaction without opening it first.");if(d=!1,0!==s.length){var n=s,t="Transaction:\n"+n.map(function(n){return"\t\t"+n.description}).join("\n");e(function(t){var e=n.length;n.forEach(function(n){n.action(function(){0===--e&&t()})})},t)}}function a(n){r(),n(),i()}var c=Array.prototype,u=[],d=!1,s=[];return n.queue=e,n.queued=t,n.beginQueueTransaction=r,n.endQueueTransaction=i,n.withQueueTransaction=a,n}function x(n){function t(){return(1679973079*v++%Math.pow(36,6)).toString(36)}function e(n){l.$root=n,l.$root.appendChild(u)}function o(){l.$root.removeChild(u)}function r(){var n={};for(var t in l.cliques)n[t]=l.cliques[t].serialize();return n}var i,a=new Array(n?55:52),c={},u=d("div"),l=y({mount:e,unmount:o,cards:a,cliques:c,$el:u,serialize:r,generateNextCliqueId:t}),f=x.modules;g(l);for(i in f)!function(n){n.deck&&n.deck(l)}(f[i]);u.classList.add("deck");for(var p,h=a.length;h;h--)p=a[h-1]=s(h-1),p.setSide("back"),p.mount(u);var v=1;return l}var $,C=[];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){setTimeout(n,0)});var b,k,S,q,I,w={linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return n<.5?2*n*n:(4-2*n)*n-1},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return 1+--n*n*n*n*n},quintInOut:function(n){return n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n}},E={deck:function(n){function t(t,e){var o=n.cards.filter(function(n){return"front"===n.side}).length/n.cards.length;n.cards.forEach(function(n,t){n.setSide(e||(o>.5?"back":"front"))}),t()}n.flip=n.queued(t)}},T={deck:function(n){function t(t,e){var o=n.cards;o.sort(function(n,t){return e?n.i-t.i:t.i-n.i}),o.forEach(function(n,r){n.sort(r,o.length,function(n){n===o.length-1&&t()},e)})}n.sort=n.queued(t)},card:function(n){var t=n.$el;n.sort=function(e,o,r,i){var a=e/4,c=10*e;n.animateTo({delay:c,duration:400,x:-a,y:-150,rot:0,onComplete:function(){t.style.zIndex=e}}),n.animateTo({delay:c+500,duration:400,x:-a,y:-a,rot:0,onComplete:function(){r(e)}})}}},A={deck:function(n){function t(t){var e=n.cards,o=t.order,r=Array(e.length);o.forEach(function(n,t){r[t]=e.find(function(t){return t.i==n})}),n.cards=r.slice(),n.queued(function(n){r.forEach(function(t,e){t.pos=e,t.shuffleTo(function(t){t===r.length-1&&n()})})})()}n.shuffleTo=t},card:function(n){var t=n.$el,r=o();n.shuffleTo=function(o){var i=n.pos,a=i/4,c=2*i;n.animateTo({delay:c,duration:200,x:e(40*Math.random()+20)*r/16,y:-a,rot:0}),n.animateTo({delay:200+c,duration:200,x:-a,y:-a,rot:0,onStart:function(){t.style.zIndex=i},onComplete:function(){o(i)}})}}},M={deck:function(n){function t(t){b=o(),n.cards=r(n.cards);var e=n.cards.slice();n.queued(function(n){e.forEach(function(t,o){t.pos=o,t.shuffle(function(t){t===e.length-1&&n()})})})()}n.shuffle=t},card:function(n){var t=n.$el;n.shuffle=function(o){var r=n.pos,i=r/4,a=2*r;n.animateTo({delay:a,duration:200,x:e(40*Math.random()+20)*b/16,y:-i,rot:0}),n.animateTo({delay:200+a,duration:200,x:-i,y:-i,rot:0,onStart:function(){t.style.zIndex=r},onComplete:function(){o(r)}})}}},L={deck:function(n){function t(t){var e=n.cards,r=e.length;k=o(),e.slice(-5).reverse().forEach(function(n,e){n.poker(e,r,function(e){n.setSide("front"),4===e&&t()})})}n.poker=n.queued(t)},card:function(n){var t=n.$el;n.poker=function(e,o,r){var i=250*e;n.animateTo({delay:i,duration:250,x:Math.round(70*(e-2.05)*k/16),y:Math.round(-110*k/16),rot:0,onStart:function(){t.style.zIndex=o-1+e},onComplete:function(){r(e)}})}}},O=document.createElement("p").style,P={},z={deck:function(t){function e(e){var o=t.cards;o.forEach(function(t,r){t.setSide("back"),t.intro(r,function(r){n(250,0).start(function(){t.setSide("back")}),r===o.length-1&&e()})})}t.intro=t.queued(e)},card:function(n){var t=i("transform"),e=n.$el;n.intro=function(o,r){var i=500+10*o,c=o/4;e.style[t]=a(-c+"px","-250px"),e.style.opacity=0,n.x=-c,n.y=-250-c,n.rot=0,n.animateTo({delay:i,duration:1e3,x:-c,y:-c,onStart:function(){e.style.zIndex=o},onProgress:function(n){e.style.opacity=n},onComplete:function(){e.style.opacity="",r&&r(o)}})}}},N={deck:function(n){function t(t){var e=n.cards,r=e.length;q=o(),e.forEach(function(n,o){n.fan(o,r,function(n){n===e.length-1&&t()})})}n.fan=n.queued(t)},card:function(n){var t=n.$el;n.fan=function(e,o,r){var i=e/4,a=10*e,c=e/(o-1)*260-130;n.animateTo({delay:a,duration:300,x:-i,y:-i,rot:0}),n.animateTo({delay:300+a,duration:300,x:55*Math.cos(u(c-90))*q/16,y:55*Math.sin(u(c-90))*q/16,rot:c,onStart:function(){t.style.zIndex=e},onComplete:function(){r(e)}})}}},G={deck:function(n){function t(t){var e=n.cards;I=o(),e.forEach(function(n){n.bysuit(function(n){n===e.length-1&&t()})})}n.bysuit=n.queued(t)},card:function(n){var t=n.rank,e=n.suit;n.bysuit=function(o){var r=n.i,i=10*r;n.animateTo({delay:i,duration:400,x:-Math.round(8*(6.75-t)*I/16),y:-Math.round(92*(1.5-e)*I/16),rot:0,onComplete:function(){o(r)}})}}};s.Side=Object.freeze({FRONT:"front",BACK:"back"});var D={fisherYates:r,getCardWidth:f,getCardHeight:p};return m.Pile=h,m.Hand=v,x.animationFrames=n,x.ease=w,x.modules={bysuit:G,fan:N,intro:z,poker:L,shuffle:M,shuffleTo:A,sort:T,flip:E},x.Card=s,x.prefix=i,x.translate=a,x.Util=D,x.Clique=m,x}();